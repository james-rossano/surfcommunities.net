const map=L.map("map").setView([40.1795,-74.0327],8);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(map);let surfSpots=[];const markers=[],labels=[];function toggleMarkersAndLabels(){map.getZoom()<10?(markers.forEach((e=>e.addTo(map))),labels.forEach((e=>map.removeLayer(e)))):(labels.forEach((e=>e.addTo(map))),markers.forEach((e=>map.removeLayer(e))))}function showDetails(e,t){const n=e.forecast.map((e=>`<button class="forecast-btn" onclick="window.open('${e.url}', '_blank')">${e.name}</button>`)).join("")||"No forecast data available";document.getElementById("spot-details").innerHTML=`\n        <div class="spot-details">\n            <strong>${e.name}</strong><br>\n            ${e.description||""}\n        </div>\n        <div class="forecast-container">\n            ${n}\n            <button class="forecast-btn" onclick="window.open('https://www.windy.com/-Waves-waves?waves,${e.coordinates.lat},${e.coordinates.lng},10', '_blank')">\n                Windy\n            </button>\n        </div>\n        <div class="descriptors">\n            <p>&#127909; Share Photos and Video</p>\n            <p>&#127940; Find Where Conditions Are Best</p>\n            <p>&#128513; Meet testing Friends</p>\n            <p>&#128198; Share Advice Discuss Forecasts</p>\n        </div>\n        <a href="https://t.me/${e.name.replace(/\s+/g,"")}_surfcommunity" target="_blank" class="community-link">\n            Join ${e.name} Community\n        </a>\n    `;const o=document.getElementById("spot-image");e.image?(o.src=e.image,o.style.display="block"):(o.src="images/test.jpg",o.style.display="block");const s=document.getElementById("info-box"),a=map.latLngToContainerPoint(t);s.style.display="block";const i=s.offsetHeight,l=s.offsetWidth;let c=a.y-50,r=a.x+10;c+i>window.innerHeight&&(c=window.innerHeight-i-20),r+l>window.innerWidth&&(r=window.innerWidth-l-20),s.style.top=`${c}px`,s.style.left=`${r}px`}function searchSurfSpot(e){displaySuggestions(surfSpots.filter((t=>t.name.toLowerCase().includes(e.toLowerCase()))))}function displaySuggestions(e){const t=document.getElementById("suggestions");t.innerHTML="",e.length>0?(e.forEach((e=>{const n=document.createElement("div");n.classList.add("suggestion-item"),n.textContent=e.name,n.addEventListener("click",(()=>{const{lat:n,lng:o}=e.coordinates;map.setView([n,o],12),showDetails(e,[n,o]),t.style.display="none"})),t.appendChild(n)})),t.style.display="block"):t.style.display="none"}fetch("/api/surfspots").then((e=>e.json())).then((e=>{surfSpots=e,e.forEach((e=>{const t=L.circleMarker([e.coordinates.lat,e.coordinates.lng],{radius:8,fillColor:"#0073e6",color:"#0073e6",weight:1,opacity:1,fillOpacity:.8}).on("click",(()=>showDetails(e,[e.coordinates.lat,e.coordinates.lng])));markers.push(t);const n=`<div class="label">${e.name}</div>`,o=L.marker([e.coordinates.lat,e.coordinates.lng],{icon:L.divIcon({className:"label-icon",html:n})}).on("click",(()=>showDetails(e,[e.coordinates.lat,e.coordinates.lng])));o.on("mouseover",(function(){this.setZIndexOffset(1e3)})),o.on("mouseout",(function(){this.setZIndexOffset(0)})),labels.push(o)})),toggleMarkersAndLabels()})).catch((e=>console.error("Error fetching surf spots:",e))),map.on("zoomend",toggleMarkersAndLabels),document.getElementById("search-input").addEventListener("input",(function(e){const t=e.target.value.trim();t.length>=2?searchSurfSpot(t):document.getElementById("suggestions").style.display="none"})),map.on("click",(()=>document.getElementById("info-box").style.display="none")),map.on("drag",(()=>document.getElementById("info-box").style.display="none")),map.on("zoomend",(()=>document.getElementById("info-box").style.display="none"));